# UBTECH 서보모터 Serial 프로토콜 (FA AF / FC CF)

> 파일명: 04_UBTECH_서보_프로토콜_FA_AF.md

# UBTECH 서보모터 통신 프로토콜 명령표 (Serial)

## 목차
- [호스트 명령 형식](#호스트-명령-형식)
- [명령 목록](#명령-목록)
  - [1. 지정 각도로 회전](#1-지정-각도로-회전)
  - [2. 강제 회전 정지](#2-강제-회전-정지)
  - [3. 각도 읽기](#3-각도-읽기)
  - [4. 서보 ID 수정](#4-서보-id-수정)
  - [5. 각도 오프셋 설정](#5-각도-오프셋-설정)
  - [6. 각도 오프셋 읽기](#6-각도-오프셋-읽기)
  - [7. 펌웨어 버전 읽기](#7-펌웨어-버전-읽기)
  - [8. 펌웨어 업그레이드](#8-펌웨어-업그레이드)
- [서보 응답 형식](#서보-응답-형식)

---

## 호스트 명령 형식

### 기본 프레임 구조

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| 프레임 헤더 1 | 프레임 헤더 2 | 서보 ID (0-240) | 명령 코드 | 파라미터 1 상위 바이트 | 파라미터 1 하위 바이트 | 파라미터 2 상위 바이트 | 파라미터 2 하위 바이트 | 체크섬 | 프레임 종료 |

**체크섬 계산**: Byte2 + Byte3 + Byte4 + Byte5 + Byte6 + Byte7의 합계에서 하위 바이트만 사용

---

## 명령 목록

### 1. 지정 각도로 회전

**명령 코드**: `01`

#### 명령 패킷

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FA | AF | 대상 서보 ID | 01 | 목표 각도 | 동작 시간 | 잠금 시간 상위 바이트 | 잠금 시간 하위 바이트 | 체크섬 | ED |

#### 파라미터 설명

**Byte2 - 서보 ID**:
- 정상 범위: 1 - 240
- ID가 0이면 모든 서보를 의미 (브로드캐스트)

**Byte4 - 목표 각도**:
- 범위: 0~240
- 단위: 도(degree)
- 최대 유효값은 240도. 240도보다 큰 값을 입력해도 서보는 240도 위치까지만 회전

**Byte5 - 동작 시간**:
- 범위: 0~255
- 단위: 20ms
- 서보가 회전하는 속도를 제어
- 값이 0이면 서보가 최대 속도로 회전

**Byte6-7 - 잠금 시간**:
- 범위: 16비트 부호 없는 정수, 0~3270
- 단위: 20ms
- (더 큰 숫자는 서보가 내부적으로 ms로 변환하므로 무의미함)
- 회전 시작 명령을 받을 때까지 서보가 01 명령에 응답하지 않음
- 위치에 도달하면 외력에 의해 각도가 변경되어도 서보가 강제로 각도를 유지

#### 응답 형식

- **성공/정상**: 1바이트 데이터만 회신
  - `0xAA` + 서보 ID
- **실패/오류**: 데이터가 반환되지 않음

---

### 2. 강제 회전 정지

**명령 코드**: `01`

#### 명령 패킷

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FA | AF | 대상 서보 ID | 01 | FF | 00 | 00 | 00 | 체크섬 | ED |

#### 설명

정지 명령을 받으면 서보는 이전 명령과 관계없이 즉시 정지하고, 위치를 유지하면서 전원이 차단되며 서보는 비활성화됩니다.

---

### 3. 각도 읽기

**명령 코드**: `02`

#### 명령 패킷

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FA | AF | 대상 서보 ID | 02 | 00 | 00 | 00 | 00 | 체크섬 | ED |

#### 설명

서보에서 각도 데이터를 반환한 후 전원이 꺼집니다.
위치는 기어 세트의 감쇠만으로 유지됩니다.

#### 응답 형식

아래 [서보 응답 형식](#서보-응답-형식) 참조

---

### 4. 서보 ID 수정

**명령 코드**: `CD`

#### 명령 패킷

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FA | AF | 대상 서보 ID | CD | 00 | 새 ID | 00 | 00 | 체크섬 | ED |

#### 설명

ID 변경은 즉시 적용됩니다.
버스에 서보가 하나만 있는 경우가 아니면 브로드캐스트 모드를 사용하지 마십시오.

#### 응답 형식

아래 [서보 응답 형식](#서보-응답-형식) 참조

---

### 5. 각도 오프셋 설정

**명령 코드**: `D2`

#### 명령 패킷

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FA | AF | 대상 서보 ID | D2 | 00 | 00 | 역방향 오프셋 상위 바이트 | 역방향 오프셋 하위 바이트 | 체크섬 | ED |

#### 파라미터 설명

**Byte4-5**: 사용 안 함

**Byte6-7 - 역방향 오프셋**:
- 범위: 16비트 부호 있는 정수, -90 ~ 90
- 단위: 1/3도
- 정면에서 볼 때 양수 값은 시계 방향 오프셋, 음수 값은 반시계 방향
- 각도로 변환 시 값의 범위는 -30도 ~ +30도
- 이 범위를 초과하여 오프셋을 설정하지 마십시오. 각도 조정으로 인해 예기치 않은 오류가 발생할 수 있습니다
- 음의 정수 인코딩에 유의하십시오
- 서보의 전원을 다시 켜면 이 설정이 지워집니다

#### 응답 형식

아래 [서보 응답 형식](#서보-응답-형식) 참조

---

### 6. 각도 오프셋 읽기

**명령 코드**: `D4`

#### 명령 패킷

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FA | AF | 대상 서보 ID | D4 | 00 | 00 | 00 | 00 | 체크섬 | ED |

#### 응답 형식

아래 [서보 응답 형식](#서보-응답-형식) 참조

---

### 7. 펌웨어 버전 읽기

**명령 코드**: `01`

#### 명령 패킷

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FC | CF | 대상 서보 ID | 01 | 00 | 00 | 00 | 00 | 체크섬 | ED |

#### 설명

대상 서보 ID: 하나의 서보에만 사용해야 합니다. 0을 입력하지 마십시오.

#### 응답 형식

아래 [서보 응답 형식](#서보-응답-형식) 참조

---

### 8. 펌웨어 업그레이드

**명령 코드**: `02`

#### 명령 패킷

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FC | CF | 대상 서보 ID | 02 | 00 | 00 | 00 | 00 | 체크섬 | ED |

#### 설명

서보가 응답 데이터를 전송한 후 즉시 부트로더로 점프합니다.
부트로더 코드를 분석하지 않았으므로 정확한 다운로드 프로토콜을 모릅니다.

#### 응답 형식

아래 [서보 응답 형식](#서보-응답-형식) 참조

---

## 서보 응답 형식

> 단일 바이트 응답 형식은 위 표를 참조하십시오.

### 기본 응답 프레임 구조

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| 프레임 헤더 1 | 프레임 헤더 2 | 서보 ID (0-240) | 명령 코드 | 파라미터 1 상위 바이트 | 파라미터 1 하위 바이트 | 파라미터 2 상위 바이트 | 파라미터 2 하위 바이트 | 체크섬 | 프레임 종료 |

---

### 1. 각도 읽기 응답

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FA | AF | 서보 ID | AA (성공) / EE (실패) | 목표 각도 상위 바이트 | 목표 각도 하위 바이트 | 실제 각도 상위 바이트 | 实际角度 하위 바이트 | 체크섬 | ED |

#### 설명

- 두 각도 모두 양의 정수입니다
- 두 값이 다르면 각도가 제대로 조정되지 않았거나 제어에 오류가 있음을 의미합니다
- 단위: 도(degree)

---

### 2. 서보 ID 수정 응답

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FA | AF | 서보 ID | 명령 코드 | 00 | 변경 전 서보 ID | 00 | 00 | 체크섬 | ED |

#### 참고

Byte2의 ID는 이미 수정된 상태입니다.

---

### 3. 각도 오프셋 설정 응답

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FA | AF | 서보 ID | 명령 코드 | 00 | 00 | 00 | 00 | 체크섬 | ED |

---

### 4. 각도 오프셋 읽기 응답

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FA | AF | 서보 ID | 명령 코드 | XX | XX | 역방향 오프셋 보정 상위 바이트 | 역방향 오프셋 보정 하위 바이트 | 체크섬 | ED |

#### 설명

- X는 불확정을 의미하며 값을 신경 쓰지 마십시오
- 유효한 파라미터의 형식은 호스트 명령 "각도 오프셋 설정"을 참조하십시오

---

### 5. 펌웨어 버전 읽기 응답

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FC | CF | 서보 ID | 명령 코드 | 버전 번호 1 | 버전 번호 2 | 버전 번호 3 | 버전 번호 4 | 체크섬 | ED |

#### 설명

서보 사용에는 영향을 미치지 않습니다.
따라서 파라미터나 형식에 대해 신경 쓰지 않았습니다.

---

### 6. 펌웨어 업그레이드 응답

| Byte0 | Byte1 | Byte2 | Byte3 | Byte4 | Byte5 | Byte6 | Byte7 | Byte8 | Byte9 |
|-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|
| FC | CF | 서보 ID | 명령 코드 | XX | XX | XX | XX | 체크섬 | ED |

#### 설명

응답 형식에 대해 신경 쓰지 마십시오.
프로그램이 부트로더로 점프했다는 것만 알면 됩니다.

---

## 참고사항

1. **체크섬 계산**: 모든 명령에서 체크섬은 Byte2부터 Byte7까지의 합계에서 하위 바이트만 사용합니다.

2. **브로드캐스트**: ID를 0으로 설정하면 버스의 모든 서보에 명령이 전송됩니다. ID 수정 시에는 주의하십시오.

3. **바이트 순서**: 이 프로토콜은 빅 엔디안 방식을 사용합니다 (상위 바이트가 먼저).

4. **프레임 헤더/종료**:
   - 일반 명령: 헤더 `FA AF`, 종료 `ED`
   - 펌웨어 관련 명령: 헤더 `FC CF`, 종료는 동일

---

## 예제

### 예제 1: ID 5인 서보를 120도로 2초(100 × 20ms) 동안 회전

```
FA AF 05 01 78 64 00 00 E2 ED
```

- Byte2: `05` (서보 ID)
- Byte3: `01` (회전 명령)
- Byte4: `78` (120도)
- Byte5: `64` (100 = 2초)
- Byte6-7: `00 00` (잠금 시간 0)
- Byte8: `E2` (체크섬: 05+01+78+64+00+00 = E2의 하위 바이트)

### 예제 2: ID 3인 서보의 각도 읽기

```
FA AF 03 02 00 00 00 00 05 ED
```

- Byte2: `03` (서보 ID)
- Byte3: `02` (각도 읽기 명령)
- Byte8: `05` (체크섬: 03+02+00+00+00+00 = 05)

---

*본 문서는 UBTECH 서보모터의 통신 프로토콜을 정리한 것입니다.*