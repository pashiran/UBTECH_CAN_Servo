# ⚙️ 60kg CAN 버스 서보 모터 통신 프로토콜

> 원본: 优必选(UBTECH) / 淘宝 분해 부품 기반 CAN 총선 서보 모터  
> 본 문서는 CAN 프로토콜을 통해 서보의 위치, ID, 상태 등을 제어하는 방법을 설명합니다.

---

## 🧩 1. 서보 위치 조회 예시

**기능:**  
CAN 버스에 연결된 모든 서보의 위치를 조회합니다.  
여러 개의 서보가 있을 경우, 각 ID별로 응답이 옵니다.  
(예: ID=8과 ID=5의 서보가 존재)

| 구분 | 설명 | 내용 |
|------|------|------|
| 송신 | 송신기 → 서보 | 0x00 0x00 0x01 0x00 … (프레임 데이터 8바이트) |
| 서보 응답 | ID=8 | 현재 각도(하위/상위 바이트) 및 버전 |
| 서보 응답 | ID=5 | 현재 각도(하위/상위 바이트) 및 버전 |

**프레임 구성 예시**

| 항목 | 내용 |
|------|------|
| 프레임 ID | 0x00 |
| 명령 | 0x01 |
| 데이터 | 8바이트 (`NULL`일 경우 0x00 채움) |
| 응답 형식 | `0xBB 0x08 0x21 0x17 …` |
| 설명 | 0x21 = 현재 각도(상위), 0x17 = 버전 |

---

## 🚀 2. 서보 운동 제어 예시

**기능:**  
ID=8 서보를 150도 위치로 이동시키며, 속도는 150°/s로 설정합니다.

| 구분 | 설명 | 내용 |
|------|------|------|
| 송신 | 송신기 → 서보 | 0x00 0x00 0x08 0x03 ... |
| 명령 | 이동 제어 명령 |
| 응답 | 정상 코드 0x00, 오류 코드 0x06 |
| 오류 코드 | 0xAA = 정상, 0xBB = 과속, 0xCC = 제한 |

**프레임 구조**

| 항목 | 내용 |
|------|------|
| 프레임 ID | 0x08 |
| 명령 코드 | 0x03 |
| 목표 각도 | 150도 (`0x96`) |
| 속도 | 150°/s (`0x96`) |
| 결과 | `0xAA` 정상 응답 |

---

## 🔧 3. 서보 ID 수정 예시

**기능:**  
서보의 고유 ID를 변경합니다.  
ID를 모를 경우 먼저 조회 명령을 사용합니다.

### (1) ID 조회

| 단계 | 설명 | 송신 | 응답 |
|------|------|------|------|
| 1 | 현재 ID 확인 | 0x00 0x08 0x07 ... | 0x08 0x08 0x71 ... |
| 2 | 서보 인증코드 수신 | `0x88 0x96 0x62` |

### (2) ID 변경

| 단계 | 설명 | 송신 | 응답 |
|------|------|------|------|
| 1 | 기존 ID=13 → 신규 ID=3 | `0x07 0x03 0x71 ...` | `0x03` |
| 2 | 인증코드 입력 | `0x88 0x96 0x62` |
| 3 | 변경 완료 응답 | `0x03` (새 ID) |

---

## 🔒 4. 서보 ID 잠금 및 해제 예시

**기능:**  
지정한 ID의 서보를 잠그거나 해제합니다.

| 동작 | 송신 | 명령 코드 | 응답 |
|------|------|-----------|------|
| 잠금 | 0x00 0x08 0x11 ... | `Lock` 명령 | 정상 응답 |
| 해제 | 0x00 0x08 0x2F ... | `Unlock` 명령 | 정상 응답 |

**잠금 시 주의사항:**
- 잠금 상태에서는 ID 변경이 불가능합니다.
- 해제 후 ID 변경 명령 사용 가능.

---

## 📘 부록

- **NULL 값**은 0x00으로 채움  
- **프레임 데이터 길이:** 8바이트 고정  
- **CAN ID 구성:**  
  - 상위 2바이트 = 프레임 식별자  
  - 하위 8바이트 = 데이터 페이로드  
- **권장 통신속도:** 500 kbps

---

_출처: Hailin / UBTECH CAN Bus Servo Reverse Engineering 자료_
